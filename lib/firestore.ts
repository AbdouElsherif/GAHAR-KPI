import { collection, doc, setDoc, getDoc, getDocs, query, where, orderBy, Timestamp, addDoc } from 'firebase/firestore'; import { db } from './firebase'; export interface KPIData { id?: string; departmentId: string; departmentName: string; month: string; year: number; data: Record<string, any>; createdAt: Date; createdBy: string; updatedAt: Date; updatedBy: string; } export async function saveKPIData(kpiData: Omit<KPIData, 'id' | 'createdAt' | 'updatedAt'>): Promise<string | null> { try { const kpiRef = collection(db, 'kpis'); const docRef = await addDoc(kpiRef, { ...kpiData, createdAt: Timestamp.now(), updatedAt: Timestamp.now() }); return docRef.id; } catch (error) { console.error('Error saving KPI data:', error); return null; } } export async function getKPIData(departmentId: string, year?: number): Promise<KPIData[]> { try { const kpiRef = collection(db, 'kpis'); let q = query(kpiRef, where('departmentId', '==', departmentId)); if (year) { q = query(q, where('year', '==', year)); } const snapshot = await getDocs(q); return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), createdAt: doc.data().createdAt?.toDate(), updatedAt: doc.data().updatedAt?.toDate() } as KPIData)); } catch (error) { console.error('Error getting KPI data:', error); return []; } } export async function getAllKPIData(): Promise<KPIData[]> { try { const kpiRef = collection(db, 'kpis'); const q = query(kpiRef, orderBy('year', 'desc'), orderBy('month', 'desc')); const snapshot = await getDocs(q); return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), createdAt: doc.data().createdAt?.toDate(), updatedAt: doc.data().updatedAt?.toDate() } as KPIData)); } catch (error) { console.error('Error getting all KPI data:', error); return []; } } export async function updateKPIData(id: string, updates: Partial<KPIData>): Promise<boolean> { try { const kpiRef = doc(db, 'kpis', id); await setDoc(kpiRef, { ...updates, updatedAt: Timestamp.now() }, { merge: true }); return true; } catch (error) { console.error('Error updating KPI data:', error); return false; } }