# دليل النسخ الاحتياطي والاستعادة الشامل 📚

## مقدمة مهمة ⚠️

هذا الدليل مكتوب خصيصاً للمبتدئين الذين لا يمتلكون أي خبرات سابقة. سأشرح لك كل خطوة بالتفصيل، وسأفترض أنك لا تعرف شيئاً عن البرمجة.

**ما هي النسخة الاحتياطية؟**
- هي نسخة كاملة من تطبيقك وبياناته
- إذا حدث أي خلل في التطبيق، يمكنك استعادة هذه النسخة
- مثل "نقطة حفظ" في لعبة فيديو - يمكنك العودة إليها في أي وقت

**ما الذي سنقوم بنسخه احتياطياً؟**
1. **الكود البرمجي** (كل الملفات والمجلدات في تطبيقك)
2. **قاعدة البيانات Firestore** (كل البيانات المخزنة)
3. **ملف الإعدادات الحساسة** (`.env.local`)

---

# القسم الأول: عمل نسخة احتياطية كاملة 💾

## المرحلة 1️⃣: نسخ الكود البرمجي احتياطياً

### الخطوة 1: فتح مجلد التطبيق
1. افتح مستكشف الملفات (File Explorer) في الويندوز
2. اذهب إلى المجلد `d:\تطبيقي`
3. الآن أنت تشاهد كل ملفات التطبيق

### الخطوة 2: إنشاء مجلد للنسخ الاحتياطية
1. اذهب إلى أي مكان آمن على جهازك (مثلاً سطح المكتب أو قرص D)
2. أنشئ مجلد جديد باسم `نسخ_احتياطية_التطبيق`
3. داخل هذا المجلد، أنشئ مجلد آخر بتاريخ اليوم (مثال: `نسخة_2025-12-12`)

### الخطوة 3: نسخ كل الملفات
1. ارجع إلى المجلد `d:\تطبيقي`
2. اضغط `Ctrl + A` لتحديد كل الملفات والمجلدات
3. اضغط `Ctrl + C` لنسخها
4. اذهب إلى المجلد الذي أنشأته `نسخ_احتياطية_التطبيق\نسخة_2025-12-12`
5. اضغط `Ctrl + V` للصق الملفات
6. **انتظر حتى تنتهي عملية النسخ تماماً** (قد تأخذ عدة دقائق)

> [!IMPORTANT]
> **ملاحظة مهمة جداً:** تأكد من نسخ **كل شيء** بما في ذلك المجلدات المخفية مثل `.env.local` و `.git`

### الخطوة 4: التأكد من اكتمال النسخ
1. افتح المجلد المنسوخ `نسخ_احتياطية_التطبيق\نسخة_2025-12-12`
2. تأكد من وجود الملفات والمجلدات التالية:
   - ✅ مجلد `app`
   - ✅ مجلد `components`
   - ✅ مجلد `lib`
   - ✅ ملف `.env.local` (ملف الإعدادات الحساسة)
   - ✅ ملف `package.json`
   - ✅ مجلد `node_modules` (كبير الحجم)

**إذا كانت كل الملفات موجودة، تهانينا! ✨ نسخة الكود جاهزة**

---

## المرحلة 2️⃣: نسخ قاعدة البيانات Firestore احتياطياً

الآن سنقوم بنسخ كل البيانات المخزنة في Firestore (المستخدمين، الإدارات، التقارير، إلخ)

### الخطوة 1: فتح نافذة الأوامر (Terminal)
1. افتح Visual Studio Code
2. من القائمة العلوية، اختر `Terminal` ثم `New Terminal`
3. ستظهر لك نافذة سوداء أو زرقاء في الأسفل

### الخطوة 2: التأكد من وجودك في المجلد الصحيح
1. في نافذة Terminal، اكتب الأمر التالي واضغط Enter:
```
pwd
```
2. يجب أن تظهر لك النتيجة: `d:\تطبيقي` أو مشابه
3. إذا لم تكن في المجلد الصحيح، اكتب:
```
cd d:\تطبيقي
```

### الخطوة 3: تشغيل أمر النسخ الاحتياطي
1. الآن اكتب هذا الأمر **بالضبط** كما هو واضغط Enter:
```
node backup-firestore.js
```

2. ستظهر لك رسائل مثل هذه:
```
🔄 Starting Firestore backup...
📦 Backing up collection: users
✅ Saved 5 documents from users
📦 Backing up collection: kpi_data
✅ Saved 120 documents from kpi_data
...
✅ Backup completed successfully!
📁 Location: d:\تطبيقي\backups\firestore-2025-12-12
🎉 All done!
```

3. **انتظر حتى ترى رسالة "All done!" 🎉**

### الخطوة 4: التأكد من نجاح النسخ الاحتياطي
1. افتح مجلد `d:\تطبيقي\backups`
2. ستجد مجلد جديد باسم `firestore-2025-12-12` (بتاريخ اليوم)
3. افتح هذا المجلد
4. يجب أن تجد ملفات `.json` مثل:
   - `users.json` (بيانات المستخدمين)
   - `kpi_data.json` (بيانات التقارير)
   - `moh_kpis.json` (مؤشرات الوزارة)
   - `accreditation_facilities.json`
   - وملفات أخرى...

**إذا وجدت هذه الملفات، ممتاز! ✨ نسخة قاعدة البيانات جاهزة**

---

## المرحلة 3️⃣: نسخ النسخة الاحتياطية لمكان آمن

> [!WARNING]
> **مهم جداً:** لا تحتفظ بالنسخة الاحتياطية على نفس الجهاز فقط!

### الخطوة 1: نسخ لهارد خارجي أو فلاش (موصى به بشدة)
1. أدخل هارد خارجي أو فلاش ميموري في جهازك
2. انسخ المجلد `نسخ_احتياطية_التطبيق` بالكامل إلى الهارد الخارجي
3. **احتفظ بهذا الهارد في مكان آمن**

### الخطوة 2: نسخ سحابي (اختياري لكن موصى به)
1. يمكنك رفع النسخة الاحتياطية إلى:
   - Google Drive
   - OneDrive
   - Dropbox
   - أي خدمة تخزين سحابي أخرى

### الخطوة 3: نسخ Firestore Backup أيضاً
1. انسخ المجلد `d:\تطبيقي\backups\firestore-2025-12-12`
2. ضعه مع النسخة الاحتياطية الأخرى
3. يمكنك أيضاً نسخه للهارد الخارجي والسحابة

**الآن لديك نسخة احتياطية كاملة محفوظة في 3 أماكن مختلفة! 🎉**

---

# القسم الثاني: استعادة التطبيق من النسخة الاحتياطية 🔄

إذا حدث أي مشكلة في التطبيق، اتبع هذه الخطوات لاستعادته:

## السيناريو 1: استعادة الكود البرمجي فقط

استخدم هذا إذا حدثت مشكلة في الكود ولكن قاعدة البيانات سليمة.

### الخطوة 1: حذف الملفات القديمة (اختياري)
> [!CAUTION]
> **تحذير:** تأكد من أن لديك نسخة احتياطية قبل الحذف!

1. اذهب إلى `d:\تطبيقي`
2. احذف **كل شيء** داخل المجلد (لكن لا تحذف المجلد نفسه)

### الخطوة 2: استعادة الكود
1. افتح النسخة الاحتياطية `نسخ_احتياطية_التطبيق\نسخة_2025-12-12`
2. حدد كل الملفات والمجلدات (Ctrl + A)
3. انسخها (Ctrl + C)
4. اذهب إلى `d:\تطبيقي`
5. الصق الملفات (Ctrl + V)
6. انتظر حتى تنتهي عملية النسخ

### الخطوة 3: إعادة تثبيت الحزم
1. افتح Terminal في Visual Studio Code
2. اكتب:
```
cd d:\تطبيقي
```
3. ثم اكتب:
```
npm install
```
4. انتظر حتى تنتهي العملية (قد تأخذ 5-10 دقائق)

### الخطوة 4: تشغيل التطبيق
1. اكتب في Terminal:
```
npm run dev
```
2. إذا ظهرت رسالة مثل `Ready on http://localhost:3000`، معناها التطبيق يعمل!
3. افتح المتصفح واذهب إلى `http://localhost:3000`
4. جرب تسجيل الدخول

**إذا نجح التطبيق في العمل، تهانينا! ✨**

---

## السيناريو 2: استعادة قاعدة البيانات فقط

استخدم هذا إذا فقدت بيانات من Firestore ولكن الكود سليم.

> [!WARNING]
> **تحذير مهم جداً:** استعادة قاعدة البيانات ستستبدل كل البيانات الحالية! أي بيانات أضفتها بعد النسخة الاحتياطية ستُحذف!

### الخطوة 1: تحديد النسخة الاحتياطية المطلوبة
1. اذهب إلى `d:\تطبيقي\backups`
2. ستجد مجلدات بتواريخ مختلفة مثل:
   - `firestore-2025-12-10`
   - `firestore-2025-12-11`
   - `firestore-2025-12-12`
3. اختر التاريخ الذي تريد استعادة البيانات منه
4. انسخ اسم المجلد بالكامل (مثال: `firestore-2025-12-12`)

### الخطوة 2: فتح Terminal
1. افتح Visual Studio Code
2. افتح Terminal جديد
3. تأكد أنك في المجلد الصحيح:
```
cd d:\تطبيقي
```

### الخطوة 3: تشغيل أمر الاستعادة
1. اكتب الأمر التالي (لكن **استبدل التاريخ** بالتاريخ الذي اخترته):
```
node restore-firestore.js backups/firestore-2025-12-12
```

2. ستظهر رسائل مثل:
```
🔄 Starting Firestore restore...
📁 From: backups/firestore-2025-12-12

📦 Restoring collection: users
✅ Restored 5 documents to users
📦 Restoring collection: kpi_data
✅ Restored 120 documents to kpi_data
...
✅ Restore completed successfully!
🎉 All done!
```

3. **انتظر حتى ترى "All done!" 🎉**

### الخطوة 4: التحقق من البيانات
1. افتح التطبيق في المتصفح
2. سجّل دخول
3. تحقق من البيانات - يجب أن تكون كما كانت في تاريخ النسخة الاحتياطية

**إذا ظهرت البيانات بشكل صحيح، ممتاز! ✨**

---

## السيناريو 3: استعادة كاملة (الكود + البيانات)

استخدم هذا في حالة انهيار التطبيق بالكامل أو إذا أردت البدء من جديد تماماً.

### ببساطة، اتبع السيناريو 1 ثم السيناريو 2 بالترتيب:

1. ✅ **أولاً:** استعد الكود البرمجي (السيناريو 1 - كل الخطوات)
2. ✅ **ثانياً:** استعد قاعدة البيانات (السيناريو 2 - كل الخطوات)

**بعد إتمام الخطوتين، تطبيقك سيعود كما كان تماماً! 🎉**

---

# نصائح مهمة جداً 💡

## متى يجب عمل نسخة احتياطية؟

> [!TIP]
> اعمل نسخة احتياطية في هذه الحالات:

1. **قبل أي تحديث أو تعديل كبير** على التطبيق
2. **مرة واحدة على الأقل كل أسبوع** (إذا كنت تستخدم التطبيق بكثرة)
3. **مرة كل شهر** كحد أدنى
4. **قبل رفع التطبيق online** أو نقله لخادم جديد
5. **بعد إدخال بيانات مهمة جداً**

## كم نسخة احتياطية يجب أن أحتفظ بها؟

> [!IMPORTANT]
> احتفظ بـ **على الأقل 3 نسخ احتياطية**:
> - النسخة الأحدث (اليوم)
> - نسخة من الأسبوع الماضي
> - نسخة من الشهر الماضي

## أين أحفظ النسخ الاحتياطية؟

> [!WARNING]
> **القاعدة الذهبية 3-2-1:**
> - **3** نسخ من بياناتك
> - على **2** نوع مختلف من وسائط التخزين
> - **1** منها في مكان خارجي (سحابة أو هارد خارجي في مكان آخر)

**مثال:**
1. نسخة على جهازك الأساسي
2. نسخة على هارد خارجي
3. نسخة على Google Drive أو OneDrive

---

# استكشاف الأخطاء وحلها 🔧

## مشكلة: "Cannot find module firebase-admin"

**الحل:**
```
npm install firebase-admin
```

## مشكلة: "Missing Firebase Admin credentials"

**الحل:**
1. تأكد من وجود ملف `.env.local` في مجلد التطبيق
2. تأكد أن الملف يحتوي على:
   - `FIREBASE_ADMIN_PROJECT_ID`
   - `FIREBASE_ADMIN_CLIENT_EMAIL`
   - `FIREBASE_ADMIN_PRIVATE_KEY`

## مشكلة: "Backup directory not found" عند الاستعادة

**الحل:**
1. تأكد من كتابة اسم المجلد بشكل صحيح
2. استخدم `/` وليس `\` في المسار
3. تأكد أن المجلد موجود فعلاً في `d:\تطبيقي\backups`

## مشكلة: "Permission denied" أو مشاكل في الصلاحيات

**الحل:**
1. أغلق Visual Studio Code تماماً
2. افتحه بصلاحيات المسؤول (Run as Administrator)
3. حاول مرة أخرى

## مشكلة: التطبيق يعمل لكن الصفحة فارغة

**الحل:**
1. امسح الـ cache من المتصفح (Ctrl + Shift + Delete)
2. أعد تشغيل التطبيق:
```
npm run dev
```

---

# قائمة التحقق السريعة ✅

## للنسخ الاحتياطي:
- [ ] نسخت كل ملفات المجلد `d:\تطبيقي`
- [ ] نسخت قاعدة البيانات باستخدام `node backup-firestore.js`
- [ ] تأكدت من وجود ملفات `.json` في مجلد `backups`
- [ ] نسخت النسخة الاحتياطية لهارد خارجي
- [ ] رفعت نسخة للسحابة (Google Drive/OneDrive)
- [ ] كتبت تاريخ النسخة الاحتياطية في ملف نصي للمرجعية

## للاستعادة:
- [ ] حددت النسخة الاحتياطية المطلوبة
- [ ] تأكدت من وجود كل الملفات في النسخة الاحتياطية
- [ ] استعدت الكود البرمجي
- [ ] شغلت `npm install`
- [ ] استعدت قاعدة البيانات (إذا لزم الأمر)
- [ ] جربت تشغيل التطبيق
- [ ] تحققت من البيانات
- [ ] سجلت دخول كمسؤول وتأكدت من كل شيء

---

# خلاصة نهائية 📝

**لعمل نسخة احتياطية:**
1. انسخ مجلد `d:\تطبيقي` بالكامل لمكان آمن
2. شغّل `node backup-firestore.js` من Terminal
3. احفظ النسخ في 3 أماكن مختلفة

**لاستعادة التطبيق:**
1. استعد الكود من النسخة المحفوظة
2. شغّل `npm install`
3. استعد قاعدة البيانات: `node restore-firestore.js backups/firestore-التاريخ`
4. شغّل التطبيق: `npm run dev`

---

> [!NOTE]
> **تذكّر:** النسخ الاحتياطي هو "تأمين" ضد أي كارثة. افعلها بانتظام ولن تندم أبداً!

**إذا واجهت أي مشكلة أو لم تفهم أي خطوة، لا تتردد في السؤال! 💙**

---

*آخر تحديث: 2025-12-12*
*تم إعداد هذا الدليل خصيصاً للمبتدئين* 🌟
